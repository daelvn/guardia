<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>guardia/init.moon</title>
<style type="text/css">
/* highlight theme: Base16 Nord */
body.hl	{ background-color:#2e3440; }
pre.hl	{ color:#e5e9f0; background-color:#2e3440; font-size:10pt; font-family:'Courier New',monospace;}
.hl.num { color:#81a1c1; }
.hl.esc { color:#d08770; }
.hl.str { color:#bf616a; }
.hl.pps { color:#d08770; }
.hl.slc { color:#4c566a; font-style:italic; }
.hl.com { color:#4c566a; font-style:italic; }
.hl.ppc { color:#b48ead; }
.hl.opt { color:#e5e9f0; }
.hl.ipl { color:#81a1c1; }
.hl.lin { color:#d8dee9; }
.hl.kwa { color:#a3be8c; font-weight:bold; }
.hl.kwb { color:#ebcb8b; font-weight:bold; }
.hl.kwc { color:#88c0d0; font-weight:bold; }
.hl.kwd { color:#5e81ac; font-weight:bold; }
.hl.kwe { color:#b48ead; font-weight:bold; }
.hl.kwf { color:#81a1c1; font-weight:bold; }
</style>
</head>
<body class="hl">
<pre class="hl"><span class="hl lin" id="L_1">    1 </span><span class="hl slc">--- Guards for Lua. Based upon [guard.lua](https://github.com/Yonaba/guard.lua).</span>
<span class="hl lin" id="L_2">    2 </span><span class="hl slc">-- This version is rather thought for curried functions and use with MoonScript.</span>
<span class="hl lin" id="L_3">    3 </span><span class="hl slc">-- &#64;module guardia.init</span>
<span class="hl lin" id="L_4">    4 </span><span class="hl slc">-- &#64;author daelvn</span>
<span class="hl lin" id="L_5">    5 </span>unpack <span class="hl kwa">or</span><span class="hl opt">=</span> <span class="hl kwb">table</span><span class="hl opt">.</span>unpack
<span class="hl lin" id="L_6">    6 </span>
<span class="hl lin" id="L_7">    7 </span><span class="hl slc">--- guard.lua-style Guard. **Curried function.**</span>
<span class="hl lin" id="L_8">    8 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_9">    9 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_10">   10 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_11">   11 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_12">   12 </span><span class="hl slc">-- &#64;return Result of `f` or nil, if guarded.</span>
<span class="hl lin" id="L_13">   13 </span>Guard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_14">   14 </span>  <span class="hl kwa">return</span> <span class="hl opt">...</span> unless filter <span class="hl opt">...</span>
<span class="hl lin" id="L_15">   15 </span>  argl <span class="hl opt">= {</span>transform <span class="hl opt">...}</span>
<span class="hl lin" id="L_16">   16 </span>  f unpack argl
<span class="hl lin" id="L_17">   17 </span>
<span class="hl lin" id="L_18">   18 </span><span class="hl slc">--- Guard that transforms when it does not pass the filter. **Curried function.**</span>
<span class="hl lin" id="L_19">   19 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_20">   20 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_21">   21 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_22">   22 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_23">   23 </span><span class="hl slc">-- &#64;return Result of `f` or nil, if not guarded.</span>
<span class="hl lin" id="L_24">   24 </span>Antiguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">false</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_25">   25 </span>  <span class="hl kwa">return</span> <span class="hl opt">...</span> <span class="hl kwa">if</span> filter <span class="hl opt">...</span>
<span class="hl lin" id="L_26">   26 </span>  argl <span class="hl opt">= {</span>transform <span class="hl opt">...}</span>
<span class="hl lin" id="L_27">   27 </span>  f unpack argl
<span class="hl lin" id="L_28">   28 </span>
<span class="hl lin" id="L_29">   29 </span><span class="hl slc">--- Guard with two transformers, one if the filte passes, one if it doesn&#39;t. **Curried function.**</span>
<span class="hl lin" id="L_30">   30 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_31">   31 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_32">   32 </span><span class="hl slc">-- &#64;tparam function antitransform If the guard is not applicable, apply this one and return. **Passed with last arg.**</span>
<span class="hl lin" id="L_33">   33 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_34">   34 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_35">   35 </span><span class="hl slc">-- &#64;return Result of `f`.</span>
<span class="hl lin" id="L_36">   36 </span>Biguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">,</span> antitransform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_37">   37 </span>  <span class="hl kwa">return if</span> filter <span class="hl opt">...</span>
<span class="hl lin" id="L_38">   38 </span>    argl <span class="hl opt">= {</span>transform <span class="hl opt">...}</span>
<span class="hl lin" id="L_39">   39 </span>    f unpack argl
<span class="hl lin" id="L_40">   40 </span>  <span class="hl kwa">else</span>
<span class="hl lin" id="L_41">   41 </span>    argl <span class="hl opt">= {</span>antitransform <span class="hl opt">...}</span>
<span class="hl lin" id="L_42">   42 </span>    f unpack argl
<span class="hl lin" id="L_43">   43 </span>
<span class="hl lin" id="L_44">   44 </span><span class="hl slc">--- Guards the result of a function.</span>
<span class="hl lin" id="L_45">   45 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_46">   46 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_47">   47 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_48">   48 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_49">   49 </span><span class="hl slc">-- &#64;return Result of `f` or nil.</span>
<span class="hl lin" id="L_50">   50 </span>Endguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_51">   51 </span>  <span class="hl kwa">return</span> <span class="hl opt">...</span> unless filter
<span class="hl lin" id="L_52">   52 </span>  res <span class="hl opt">= {</span>f <span class="hl opt">...}</span>
<span class="hl lin" id="L_53">   53 </span>  transform unpack res
<span class="hl lin" id="L_54">   54 </span>
<span class="hl lin" id="L_55">   55 </span><span class="hl slc">--- Guard that errors when it does not pass. **Curried function.**</span>
<span class="hl lin" id="L_56">   56 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_57">   57 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_58">   58 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_59">   59 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_60">   60 </span><span class="hl slc">-- &#64;return Whatever `f` returns.</span>
<span class="hl lin" id="L_61">   61 </span><span class="hl slc">-- &#64;raise If the filter does not pass, it will error.</span>
<span class="hl lin" id="L_62">   62 </span>Errguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_63">   63 </span>  ok<span class="hl opt">,</span> why <span class="hl opt">=</span> filter <span class="hl opt">...</span>
<span class="hl lin" id="L_64">   64 </span>  <span class="hl kwb">error</span> <span class="hl str">&quot;did not pass guard! #{why}&quot;</span> unless ok
<span class="hl lin" id="L_65">   65 </span>  argl <span class="hl opt">= {</span>transform <span class="hl opt">...}</span>
<span class="hl lin" id="L_66">   66 </span>  f unpack argl
<span class="hl lin" id="L_67">   67 </span>
<span class="hl lin" id="L_68">   68 </span><span class="hl slc">--- Guard that errors when passed. **Curried function.**</span>
<span class="hl lin" id="L_69">   69 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_70">   70 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_71">   71 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_72">   72 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_73">   73 </span><span class="hl slc">-- &#64;return Whatever `f` returns.</span>
<span class="hl lin" id="L_74">   74 </span><span class="hl slc">-- &#64;raise If the filter does not pass, it will error.</span>
<span class="hl lin" id="L_75">   75 </span>Antierrguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_76">   76 </span>  ok<span class="hl opt">,</span> why <span class="hl opt">=</span> filter <span class="hl opt">...</span>
<span class="hl lin" id="L_77">   77 </span>  <span class="hl kwb">error</span> <span class="hl str">&quot;did not pass guard! #{why}&quot;</span> <span class="hl kwa">if</span> ok
<span class="hl lin" id="L_78">   78 </span>  argl <span class="hl opt">= {</span>transform <span class="hl opt">...}</span>
<span class="hl lin" id="L_79">   79 </span>  f unpack argl
<span class="hl lin" id="L_80">   80 </span>
<span class="hl lin" id="L_81">   81 </span><span class="hl slc">--- Guards the result of a function. This one raises an error if it does not pass.</span>
<span class="hl lin" id="L_82">   82 </span><span class="hl slc">-- &#64;tparam function filter Filters whether the guard is applicable or not.</span>
<span class="hl lin" id="L_83">   83 </span><span class="hl slc">-- &#64;tparam function transform If the guard is applicable, apply it and return.</span>
<span class="hl lin" id="L_84">   84 </span><span class="hl slc">-- &#64;tparam function f Function to be guarded.</span>
<span class="hl lin" id="L_85">   85 </span><span class="hl slc">-- &#64;param ... Arguments to pass to `f`</span>
<span class="hl lin" id="L_86">   86 </span><span class="hl slc">-- &#64;return Result of `f` or nil.</span>
<span class="hl lin" id="L_87">   87 </span><span class="hl slc">-- &#64;raise If the filter does not pass, it will error.</span>
<span class="hl lin" id="L_88">   88 </span>Enderrguard <span class="hl opt">= (</span>filter<span class="hl opt">=-&gt;</span><span class="hl kwa">true</span><span class="hl opt">) -&gt; (</span>transform<span class="hl opt">) -&gt; (</span>f<span class="hl opt">) -&gt; (...) -&gt;</span>
<span class="hl lin" id="L_89">   89 </span>  ok<span class="hl opt">,</span> why <span class="hl opt">=</span> filter <span class="hl opt">...</span>
<span class="hl lin" id="L_90">   90 </span>  <span class="hl kwb">error</span> <span class="hl str">&quot;did not pass guard! #{why}&quot;</span> unless ok
<span class="hl lin" id="L_91">   91 </span>  res <span class="hl opt">= {</span>f <span class="hl opt">...}</span>
<span class="hl lin" id="L_92">   92 </span>  transform unpack res
<span class="hl lin" id="L_93">   93 </span>
<span class="hl lin" id="L_94">   94 </span><span class="hl slc">--- Simple function composition.</span>
<span class="hl lin" id="L_95">   95 </span><span class="hl slc">-- &#64;param ... All functions to compose</span>
<span class="hl lin" id="L_96">   96 </span><span class="hl slc">-- &#64;treturn function Composed function.</span>
<span class="hl lin" id="L_97">   97 </span>compose <span class="hl opt">= (...) -&gt;</span>
<span class="hl lin" id="L_98">   98 </span>  argl <span class="hl opt">= {...}</span>
<span class="hl lin" id="L_99">   99 </span>  <span class="hl opt">(...) -&gt;</span>
<span class="hl lin" id="L_100">  100 </span>    argk <span class="hl opt">= {...}</span>
<span class="hl lin" id="L_101">  101 </span>    <span class="hl kwa">for</span> f <span class="hl kwa">in</span> <span class="hl opt">*</span>argl
<span class="hl lin" id="L_102">  102 </span>      argk <span class="hl opt">=</span> f argk
<span class="hl lin" id="L_103">  103 </span>    <span class="hl kwa">return</span> argk
<span class="hl lin" id="L_104">  104 </span>
<span class="hl lin" id="L_105">  105 </span><span class="hl opt">{ :</span>Guard<span class="hl opt">, :</span>Antiguard<span class="hl opt">, :</span>Biguard<span class="hl opt">, :</span>Endguard<span class="hl opt">, :</span>Errguard<span class="hl opt">, :</span>Antierrguard<span class="hl opt">, :</span>Enderrguard<span class="hl opt">, :</span>compose <span class="hl opt">}</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 3.53, http://www.andre-simon.de/-->
